# 学生批量导入文件格式规范（按班级区分）

## 1. 概述

为了方便批量导入学生信息并自动关联班级，系统支持按班级区分的导入方式，每个班级一个Excel文件。文件名中包含格式化的班级信息，使系统能够自动识别并创建班级。

本文档详细说明了使用按班级区分导入功能时的文件格式要求。

## 2. 文件命名规范

按班级区分的Excel文件必须遵循以下命名格式：

```
专业名称_年级级_班号班_其他信息.xlsx
```

### 2.1 格式说明

- **专业名称**: 完整的专业名称，如"计算机科学与技术"
- **年级**: 两位数字年级后跟"级"字，如"22级"
- **班号**: 班级序号后跟"班"字，如"1班"
- **其他信息**: 任意附加信息，通常包含时间戳以确保文件名唯一

### 2.2 文件名示例

- `计算机科学与技术_22级_1班_20250621213131.xlsx`
- `软件工程_23级_2班_20250621210947.xlsx`

## 3. Excel文件内容格式

### 3.1 必需列

Excel文件必须包含以下列，且第一行为表头：

| 列名      | 描述                  | 是否必填 | 说明                               |
|-----------|----------------------|---------|-----------------------------------|
| studentNo | 学号                  | 是      | 唯一标识，不可重复                   |
| realName  | 真实姓名              | 是      | 学生真实姓名                        |
| gender    | 性别                  | 是      | 0: 女, 1: 男                       |
| username  | 用户名                | 是      | 唯一标识，建议格式: stu + 学号       |
| phone     | 电话号码              | 否      | 可选字段                            |
| email     | 电子邮件              | 否      | 可选字段                            |
| majorCode | 专业代码              | 否      | 专业标识代码                        |
| classCode | 班级代码/名称          | 否      | 班级信息，将被文件名中解析的班级信息覆盖 |
| college   | 学院                  | 否      | 所属学院                            |
| school    | 学校                  | 否      | 学校名称                            |
| password  | 密码                  | 否      | 不填则使用默认密码"123456"           |

### 3.2 示例数据

| studentNo | realName | gender | username    | phone       | email                 | majorCode | classCode          | college              | school       | password |
|-----------|----------|--------|-------------|-------------|----------------------|-----------|--------------------|--------------------|--------------|----------|
| 46220001  | 张三      | 1      | stu46220001 | 13800138001 | stu46220001@example.com | 46        | 计算机科学与技术22-1班 | 计算机科学与技术学院   | 中国矿业大学   | 123456   |
| 46220002  | 李四      | 0      | stu46220002 | 13800138002 | stu46220002@example.com | 46        | 计算机科学与技术22-1班 | 计算机科学与技术学院   | 中国矿业大学   | 123456   |

## 4. 班级关联处理逻辑

系统将按照以下逻辑处理班级关联：

1. 从文件名解析专业名称、年级和班号
2. 构建标准班级名称，如"计算机科学与技术22-1班"
3. 检查该班级是否已存在：
   - 若已存在，使用现有班级
   - 若不存在，自动创建新班级
4. 创建学生与班级的关联关系，同时写入：
   - 学生表中的classCode字段
   - 学生班级关联表的记录

## 5. 导入接口

使用以下接口进行导入：

```
POST /api/eduagentx/admin/register/student/excel/with-class
```

该接口会自动处理以下工作：
1. 解析Excel文件内容，获取学生基本信息
2. 从文件名解析班级信息
3. 如果班级不存在，自动创建班级
4. 创建学生记录并关联到班级

## 6. 批量生成工具

系统提供`generate_students_by_class.py`脚本用于生成符合上述规范的Excel文件。该脚本：

1. 按班级生成学生数据，每个班级一个Excel文件
2. 生成符合命名规范的文件名，包含专业名称、年级和班号
3. 自动计算学号，确保不会重复

使用前，请确保已安装所需依赖：
```bash
pip install faker openpyxl
```

## 7. 注意事项

- 每个文件应仅包含一个班级的学生
- 每个班级的学生应放在单独的文件中，以确保班级关联的准确性
- 文件名必须严格遵循规范，否则可能导致班级信息解析错误
- 如果Excel中classCode列的值与文件名解析出的班级不同，将以文件名解析结果为准
- 在大批量导入时，建议先测试少量数据，确认格式正确后再进行完整导入
