# 学生批量导入文件格式规范

## 1. 概述

为了方便批量导入学生信息并自动关联班级，系统支持两种导入方式：
1. 标准导入 - 仅导入学生基本信息
2. 带班级关联的导入 - 导入学生信息并自动处理班级关联

本文档详细说明了使用带班级关联导入功能时的文件格式要求。

## 2. Excel文件内容格式

### 2.1 必需列

Excel文件必须包含以下列，且第一行为表头：

| 列名      | 描述                  | 是否必填 | 说明                               |
|-----------|----------------------|---------|-----------------------------------|
| studentNo | 学号                  | 是      | 唯一标识，不可重复                   |
| realName  | 真实姓名              | 是      | 学生真实姓名                        |
| gender    | 性别                  | 是      | 0: 女, 1: 男                       |
| username  | 用户名                | 是      | 唯一标识，建议格式: stu + 学号       |
| phone     | 电话号码              | 否      | 可选字段                            |
| email     | 电子邮件              | 否      | 可选字段                            |
| majorCode | 专业代码              | 否      | 专业标识代码                        |
| classCode | 班级代码/名称          | 否      | 班级信息，可由文件名提供              |
| college   | 学院                  | 否      | 所属学院                            |
| school    | 学校                  | 否      | 学校名称                            |
| password  | 密码                  | 否      | 不填则使用默认密码"123456"           |

### 2.2 示例数据

| studentNo | realName | gender | username    | phone       | email                 | majorCode | classCode          | college              | school       | password |
|-----------|----------|--------|-------------|-------------|----------------------|-----------|--------------------|--------------------|--------------|----------|
| 46220001  | 张三      | 1      | stu46220001 | 13800138001 | stu46220001@example.com | 46        | 计算机科学与技术22-1班 | 计算机科学与技术学院   | 中国矿业大学   | 123456   |
| 46220002  | 李四      | 0      | stu46220002 | 13800138002 | stu46220002@example.com | 46        | 计算机科学与技术22-1班 | 计算机科学与技术学院   | 中国矿业大学   | 123456   |

## 3. 文件命名规范

为了支持自动关联班级功能，Excel文件名必须遵循以下格式：

```
专业名称_年级级_其他信息.xlsx
```

### 3.1 格式说明

- **专业名称**: 完整的专业名称，如"计算机科学与技术"
- **年级**: 两位数字年级后跟"级"字，如"22级"
- **其他信息**: 任意附加信息，通常包含时间戳以确保文件名唯一

### 3.2 文件名示例

- `计算机科学与技术_22级_20250621213131.xlsx`
- `软件工程_23级_20250621210947.xlsx`

## 4. 班级关联处理逻辑

系统将按照以下逻辑处理班级关联：

1. 从文件名解析专业名称和年级
2. 构建默认班级名称，如"计算机科学与技术22-1班"
3. 检查该班级是否已存在：
   - 若已存在，使用现有班级
   - 若不存在，自动创建新班级
4. 创建学生与班级的关联关系
5. 如果Excel中的`classCode`列有值，则优先使用该值

## 5. 导入接口说明

### 5.1 标准导入接口

```
POST /api/eduagentx/admin/register/student/excel
```

仅导入学生信息，不处理班级关联。

### 5.2 带班级关联的导入接口

```
POST /api/eduagentx/admin/register/student/excel/with-class
```

导入学生信息并自动处理班级关联，需符合上述文件命名规范。

## 6. 批量生成工具

系统提供`generate_students_improved_v2.py`脚本用于生成符合上述规范的Excel文件。使用该脚本可以：

1. 指定专业代码、年级、班级数量和每班学生数量
2. 自动生成符合规范的学生数据
3. 创建符合命名规范的Excel文件

请按照脚本提示操作，确保已安装所需依赖：
```bash
pip install faker openpyxl
```

## 7. 注意事项

- 文件大小不应超过10MB
- 单次导入学生数量建议不超过1000名
- 导入过程中如遇到重复学号或用户名，系统将自动跳过对应记录
- 班级关联处理依赖正确的文件命名格式，请严格遵循命名规范
